<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Kimjong Store (Digital Marketplace)</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #1a1a2e; padding: 20px; color: #e9ecef; }
        .container { max-width: 750px; margin: 0 auto; }
        .card { background: #16213e; padding: 20px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); margin-bottom: 20px; border-top: 4px solid #0f3460; }
        h2, h3 { margin-top: 0; color: #e94560; }
        label { font-weight: bold; font-size: 14px; display: block; margin-top: 15px; color: #a2a8d3; }
        input, textarea, select { width: 100%; padding: 10px; margin-top: 5px; border: 1px solid #0f3460; border-radius: 5px; box-sizing: border-box; background: #0f3460; color: white; font-family: inherit; }
        input::placeholder, textarea::placeholder { color: #7f8c8d; }
        button { padding: 12px 15px; background-color: #e94560; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; margin-top: 15px; width: 100%; transition: 0.3s; }
        button:hover { background-color: #d13b56; }
        .btn-success { background-color: #28a745; }
        .btn-success:hover { background-color: #218838; }
        .btn-danger { background-color: #dc3545; }
        .btn-danger:hover { background-color: #c82333; }
        .btn-warning { background-color: #ffc107; color: #1a1a2e; }
        .btn-warning:hover { background-color: #e0a800; }
        .btn-info { background-color: #17a2b8; }
        .flex-btn { display: flex; gap: 10px; }
        #log { background: #0f3460; color: #00ffcc; padding: 15px; height: 150px; overflow-y: scroll; font-family: monospace; font-size: 13px; border-radius: 5px; margin-top: 10px; line-height: 1.5; border: 1px solid #1a1a2e; }
        .list-item { background: #1a1a2e; border: 1px solid #0f3460; padding: 15px; margin-top: 10px; border-radius: 5px; display: flex; justify-content: space-between; align-items: center; }
        .badge { background: #e94560; color: white; padding: 3px 8px; border-radius: 10px; font-size: 11px; margin-right: 5px; }
        .badge-menu { background: #4caf50; color: white; padding: 3px 8px; border-radius: 10px; font-size: 11px; margin-right: 5px; }
        .peringatan { color: #fff; background-color: #e94560; padding: 10px; border-radius: 5px; font-size: 13px; text-align: center; font-weight: bold; margin-bottom: 20px; }
    </style>
</head>
<body>

    <div class="container">
        <h2 style="text-align: center;">‚ö° Admin Panel Kimjong Store V4</h2>
        <p style="text-align: center; color: #a2a8d3; margin-top: -10px;">Digital Marketplace (Web Dev & Game Cheats)</p>
        <p class="peringatan">Biarkan tab browser ini tetap terbuka agar bot tetap menyala.</p>

        <div class="card">
            <h3>1. Pengaturan Sistem</h3>
            <label>Token Bot Telegram:</label>
            <input type="text" id="botToken" value="8614978857:AAEn_6YWeJquoP9Qpj5XKEs9IO2BQYGUs2E" placeholder="Masukkan token bot...">
            
            <label>ID Telegram Admin (Untuk notifikasi/konsultasi):</label>
            <input type="text" id="adminId" value="5552266500" placeholder="ID Telegram kamu...">
            
            <button onclick="mulaiBot()" id="btnMulai">‚ñ∂ Nyalakan Bot Sekarang</button>
            <button onclick="matikanBot()" id="btnMati" class="btn-danger" style="display:none;">‚èπ Matikan Bot</button>
        </div>

        <div class="card">
            <h3>2. üíæ Keamanan Data (Backup & Restore)</h3>
            <p style="font-size: 12px; color: #a2a8d3;">Backup data menu & pelanggan agar tidak hilang jika browser dibersihkan.</p>
            <div class="flex-btn">
                <button onclick="backupData()" class="btn-info">‚¨áÔ∏è Download Data Bot</button>
                <button onclick="document.getElementById('fileUpload').click()" class="btn-warning">‚¨ÜÔ∏è Upload Data Bot</button>
                <input type="file" id="fileUpload" style="display:none;" accept=".json" onchange="restoreData(event)">
            </div>
        </div>

        <div class="card">
            <h3>3. üì¢ Siaran Promo (Broadcast)</h3>
            <p style="font-size: 12px; color: #a2a8d3;">Jumlah Pelanggan Tersimpan: <b id="jumlahUser" style="color: #e94560;">0</b></p>
            <textarea id="pesanBroadcast" rows="2" placeholder="Contoh: Diskon 20% untuk pembuatan Web Toko Online hari ini!"></textarea>
            <button onclick="kirimBroadcast()" class="btn-warning" style="color: #1a1a2e; font-weight: bold;">üì¢ Kirim Promo Massal</button>
        </div>

        <div class="card">
            <h3>4. ‚ûï Tambah Menu Produk Digital</h3>
            
            <label>Nama Tombol Menu (Contoh: üíª Jasa Web, üéÆ Cheat VIP):</label>
            <input type="text" id="cmd" placeholder="Ketik nama tombol menu...">
            
            <label>Tipe Balasan:</label>
            <select id="tipePesan" onchange="ubahFormTipe()">
                <option value="text">Teks Harga / Deskripsi</option>
                <option value="image">Teks + Gambar Preview Produk</option>
                <option value="button">Teks + Tombol Link Pembayaran/Order</option>
            </select>

            <div id="formGambar" style="display: none;">
                <label>URL Gambar (Link Foto Preview Web/Cheat):</label>
                <input type="text" id="imgUrl" placeholder="Contoh: https://domain.com/preview.jpg">
            </div>

            <div id="formTombol" style="display: none;">
                <label>Teks Tombol Order:</label>
                <input type="text" id="btnText" placeholder="Contoh: Chat Admin Sekarang">
                <label>URL Tujuan (Link WA/Tele Admin):</label>
                <input type="text" id="btnUrl" placeholder="Contoh: https://t.me/username_kamu">
            </div>
            
            <label>Isi Keterangan (Pricelist / Fitur Cheat / Spek Web):</label>
            <textarea id="reply" rows="4" placeholder="Ketik balasan bot di sini..."></textarea>
            
            <button onclick="simpanFitur()" class="btn-success">üíæ Simpan Menu Produk</button>
        </div>

        <div class="card">
            <h3>5. üìã Menu Produk Aktif</h3>
            <div id="listFitur"></div>
        </div>

        <div class="card">
            <h3>üñ•Ô∏è Terminal Log (Live)</h3>
            <div id="log">Sistem Digital Store siap...<br></div>
        </div>
    </div>

    <script>
        let botInterval;
        let lastUpdateId = 0;

        // Database Default untuk Produk Digital
        let databaseFitur = JSON.parse(localStorage.getItem('kimjong_db')) || [
            { command: '/start', type: 'text', reply: 'Selamat datang di Kimjong Store! ‚ö°\n\nKami melayani:\n1. Jasa Pembuatan Website Terpercaya\n2. Pembelian Cheat Game (100% Work & Safe)\n\nSilakan pilih menu di bawah ini:' },
            { command: 'üíª Jasa Web', type: 'text', reply: 'Pricelist Pembuatan Website:\n\n1. Web Landing Page: Rp 500.000\n2. Web Company Profile: Rp 1.500.000\n3. Web Toko Online: Rp 2.500.000\n\nFull-stack, animasi, dan desain premium. Klik menu Konsultasi untuk detail.' },
            { command: 'üéÆ Cheat Game', type: 'text', reply: 'List Cheat Tersedia (VIP Aimbot + ESP):\n\n- Valorant (Aman Anti-Ban): Rp 300k/Bulan\n- PUBG Mobile: Rp 150k/Bulan\n- Point Blank: Rp 100k/Bulan\n\nCheat langsung dikirim otomatis setelah transfer.' },
            { command: 'üí¨ Konsultasi Admin', type: 'button', reply: 'Mau request fitur web khusus atau tanya soal cheat? Silakan chat langsung dengan admin kami.', btnText: 'Hubungi Admin', btnUrl: 'https://t.me/telegram' }
        ];
        
        let penggunaBot = JSON.parse(localStorage.getItem('kimjong_users')) || [];
        document.getElementById('jumlahUser').innerText = penggunaBot.length;

        function ubahFormTipe() {
            const tipe = document.getElementById('tipePesan').value;
            document.getElementById('formGambar').style.display = (tipe === 'image') ? 'block' : 'none';
            document.getElementById('formTombol').style.display = (tipe === 'button') ? 'block' : 'none';
        }

        function renderFitur() {
            const list = document.getElementById('listFitur');
            list.innerHTML = '';
            if(databaseFitur.length === 0) list.innerHTML = '<p style="text-align:center;">Belum ada menu produk.</p>';
            
            databaseFitur.forEach((item, index) => {
                let badgeTipe = item.type === 'image' ? 'üñºÔ∏è Gambar' : item.type === 'button' ? 'üîó Link Order' : 'üìù Info';
                let tombolBadge = `<span class="badge-menu">üîò Menu Bot</span>`;
                
                list.innerHTML += `
                    <div class="list-item">
                        <div style="width: 80%;">
                            <b style="color:#e94560;">${item.command}</b> ${tombolBadge} <span class="badge">${badgeTipe}</span><br> 
                            <span style="font-size:13px; color:#a2a8d3; display:block; margin-top:5px; white-space: pre-wrap;">${item.reply}</span>
                        </div>
                        <button class="btn-danger" style="width:auto; padding:8px 12px; margin:0;" onclick="hapusFitur(${index})">Hapus</button>
                    </div>`;
            });
        }

        function simpanFitur() {
            const cmd = document.getElementById('cmd').value.trim();
            const tipe = document.getElementById('tipePesan').value;
            const reply = document.getElementById('reply').value.trim();
            const imgUrl = document.getElementById('imgUrl').value.trim();
            const btnText = document.getElementById('btnText').value.trim();
            const btnUrl = document.getElementById('btnUrl').value.trim();
            
            if(!cmd || !reply) return alert("Perintah dan Keterangan wajib diisi!");
            
            databaseFitur.push({ command: cmd, type: tipe, reply: reply, imgUrl: imgUrl, btnText: btnText, btnUrl: btnUrl });
            localStorage.setItem('kimjong_db', JSON.stringify(databaseFitur));
            
            document.getElementById('cmd').value = '';
            document.getElementById('reply').value = '';
            renderFitur();
            tulisLog(`‚úÖ Menu '${cmd}' berhasil ditambahkan!`);
        }

        function hapusFitur(index) {
            if(confirm("Hapus menu ini?")) {
                databaseFitur.splice(index, 1);
                localStorage.setItem('kimjong_db', JSON.stringify(databaseFitur));
                renderFitur();
                tulisLog(`üóëÔ∏è Menu dihapus.`);
            }
        }

        function tulisLog(pesan) {
            const logDiv = document.getElementById('log');
            const waktu = new Date().toLocaleTimeString('id-ID');
            logDiv.innerHTML += `[${waktu}] ${pesan}<br>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function buatMenuBawah() {
            let keyboardData = [];
            let baris = [];
            databaseFitur.forEach((fitur, index) => {
                if(fitur.command.toLowerCase() !== '/start') { baris.push({ text: fitur.command }); }
                if (baris.length === 2 || index === databaseFitur.length - 1) {
                    if(baris.length > 0) { keyboardData.push(baris); baris = []; }
                }
            });
            return { keyboard: keyboardData, resize_keyboard: true, is_persistent: true };
        }

        // --- FITUR BACKUP & RESTORE ---
        function backupData() {
            const dataToSave = {
                db: databaseFitur,
                users: penggunaBot
            };
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(dataToSave));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", "Backup_KimjongStore.json");
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
            tulisLog("üíæ Backup data bot berhasil didownload.");
        }

        function restoreData(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    if(importedData.db) {
                        databaseFitur = importedData.db;
                        localStorage.setItem('kimjong_db', JSON.stringify(databaseFitur));
                        renderFitur();
                    }
                    if(importedData.users) {
                        penggunaBot = importedData.users;
                        localStorage.setItem('kimjong_users', JSON.stringify(penggunaBot));
                        document.getElementById('jumlahUser').innerText = penggunaBot.length;
                    }
                    tulisLog("‚¨ÜÔ∏è Restore data berhasil dimuat!");
                    alert("Data berhasil dipulihkan!");
                } catch (err) {
                    alert("Gagal membaca file backup!");
                }
            };
            reader.readAsText(file);
        }

        // --- MESIN BOT TELEGRAM ---
        function mulaiBot() {
            const token = document.getElementById('botToken').value.trim();
            if(!token) return alert("Token Bot kosong!");
            document.getElementById('btnMulai').style.display = 'none';
            document.getElementById('btnMati').style.display = 'block';
            tulisLog("üöÄ Menghubungkan ke server Telegram...");
            botInterval = setInterval(() => tarikPesan(token), 1500);
        }

        function matikanBot() {
            clearInterval(botInterval);
            document.getElementById('btnMulai').style.display = 'block';
            document.getElementById('btnMati').style.display = 'none';
            tulisLog("üõë Bot offline.");
        }

        async function tarikPesan(token) {
            try {
                const response = await fetch(`https://api.telegram.org/bot${token}/getUpdates?offset=${lastUpdateId + 1}`);
                const data = await response.json();

                if (data.ok && data.result.length > 0) {
                    for (let update of data.result) {
                        lastUpdateId = update.update_id;

                        if (update.message && update.message.text) {
                            const chatId = update.message.chat.id;
                            const teksUser = update.message.text;
                            const namaUser = update.message.chat.first_name || "Pelanggan";
                            
                            tulisLog(`üí¨ [${namaUser}]: ${teksUser}`);

                            if (!penggunaBot.includes(chatId)) {
                                penggunaBot.push(chatId);
                                localStorage.setItem('kimjong_users', JSON.stringify(penggunaBot));
                                document.getElementById('jumlahUser').innerText = penggunaBot.length;
                            }

                            const cariFitur = databaseFitur.find(f => f.command.toLowerCase() === teksUser.toLowerCase());

                            if (cariFitur) {
                                prosesBalasan(token, chatId, cariFitur);
                            } else {
                                // Default balasan jika tidak klik menu
                                prosesBalasan(token, chatId, { type: 'text', reply: "Silakan pilih menu di bawah ini untuk melihat layanan web atau daftar cheat." });
                            }
                        }
                    }
                }
            } catch (error) {}
        }

        async function prosesBalasan(token, chatId, fitur) {
            let apiUrl = `https://api.telegram.org/bot${token}/`;
            let payload = { chat_id: chatId };
            let menuBawahDinami = buatMenuBawah();

            if (fitur.type === 'image') {
                apiUrl += 'sendPhoto';
                payload.photo = fitur.imgUrl;
                payload.caption = fitur.reply;
                payload.reply_markup = menuBawahDinami;
            } else {
                apiUrl += 'sendMessage';
                payload.text = fitur.reply;
                
                if (fitur.type === 'button') {
                    payload.reply_markup = { inline_keyboard: [[{ text: fitur.btnText, url: fitur.btnUrl }]] };
                } else {
                    payload.reply_markup = menuBawahDinami;
                }
            }

            try {
                await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
            } catch (error) { tulisLog(`‚ùå Gagal merespons ke ${chatId}`); }
        }

        async function kirimBroadcast() {
            const token = document.getElementById('botToken').value.trim();
            const pesan = document.getElementById('pesanBroadcast').value.trim();
            if(!token || !pesan) return alert("Pesan terisi!");
            if(confirm(`Kirim pesan promo ke ${penggunaBot.length} pengguna?`)) {
                tulisLog(`üì¢ Memulai Broadcast Promo...`);
                for(let id of penggunaBot) {
                    try {
                        await fetch(`https://api.telegram.org/bot${token}/sendMessage`, {
                            method: 'POST', headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ chat_id: id, text: "‚ö° INFORMASI KIMJONG STORE ‚ö°\n\n" + pesan, reply_markup: buatMenuBawah() })
                        });
                    } catch(e) {}
                }
                tulisLog(`‚úÖ Broadcast Promo selesai.`);
                document.getElementById('pesanBroadcast').value = '';
            }
        }

        renderFitur();
    </script>
</body>
</html>
